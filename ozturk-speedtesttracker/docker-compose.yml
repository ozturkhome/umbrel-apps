version: "3.7"

services:
  server:
    container_name: speedtest-tracker
    image: linuxserver/speedtest-tracker:latest
    ports:
      - 5173:80 
    volumes:
      - ${APP_DATA_DIR}/data:/config
    environment:
      - PUID=1000              # Kullanıcı ID (Linux kullanıcı ID'nizle değiştirin)
      - PGID=1000              # Grup ID (Linux grup ID'nizle değiştirin)
      - TZ=Europe/Istanbul     # Zaman dilimi
      - TELEGRAM_TOKEN=        # (İsteğe bağlı) Telegram entegrasyonu
      - TELEGRAM_CHATID=       # (İsteğe bağlı) Telegram chat ID
    entrypoint: >
      sh -c "
        if [ ! -f /config/.env ]; then
          echo 'APP_KEY=placeholder' > /config/.env;
        fi;
        if ! grep -q 'APP_KEY=base64:' /config/.env; then
          cp /var/www/html/.env.example /config/.env;
          php artisan key:generate --force --ansi;
        fi;
        php-fpm &
        nginx -g 'daemon off;'
      "
    restart: always